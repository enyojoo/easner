"use strict";(()=>{var e={};e.id=866,e.ids=[866],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},68580:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>l});var n=r(49303),s=r(88716),o=r(60670),i=r(87070),u=r(23380),p=r(85662);async function c(e){let t=(0,p.lx)(),r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))throw Error("No authorization header");let a=r.substring(7),{data:{user:n},error:s}=await t.auth.getUser(a);if(s||!n)throw Error("Invalid token");return n}async function d(e){try{let t=await c(e),r=await u.Ov.getByUserId(t.id);return i.NextResponse.json({transactions:r})}catch(e){return console.error("Get transactions error:",e),i.NextResponse.json({error:"Authentication required"},{status:401})}}async function l(e){try{let t=await c(e),{recipientId:r,sendAmount:a,sendCurrency:n,receiveCurrency:s}=await e.json(),o=await u.yE.getRate(n,s);if(!o)return i.NextResponse.json({error:"Exchange rate not available"},{status:400});let p=a*o.rate,d=0;"fixed"===o.fee_type?d=o.fee_amount:"percentage"===o.fee_type&&(d=a*o.fee_amount/100);let l=a+d,h=await u.Ov.create({userId:t.id,recipientId:r,sendAmount:a,sendCurrency:n,receiveAmount:p,receiveCurrency:s,exchangeRate:o.rate,feeAmount:d,feeType:o.fee_type,totalAmount:l});return i.NextResponse.json({transaction:h})}catch(e){if(console.error("Create transaction error:",e),"Authentication required"===e.message||"Invalid token"===e.message)return i.NextResponse.json({error:"Authentication required"},{status:401});return i.NextResponse.json({error:"Failed to create transaction"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/transactions/route",pathname:"/api/transactions",filename:"route",bundlePath:"app/api/transactions/route"},resolvedPagePath:"D:\\Users\\enyoc\\Documents\\Dev\\easner\\app\\api\\transactions\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:g}=h,m="/api/transactions/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,338,380],()=>r(68580));module.exports=a})();